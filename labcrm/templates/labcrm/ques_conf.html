{% extends 'base2.html' %}
{% block title %}问卷配置{% endblock %}
{% block header %}
<li><a href='{% url "crm:add" %}'>添加提问</a></li>
{% endblock %} 
{% block row-left %}
<div class="btn-group btn-group-vertical">
	<div class='btn btn-info'><h3>生成问卷</h3></div><hr />
	<div class='btn btn-info'><h3>提问修改</h3></div><hr />
	<div class='btn btn-info'><h3>添加提问</h3></div>
</div>
{% endblock %}
{% block row-right %}
<div class="row">
	<div class="col-md-9" id='box_preview'>
		<table class="table table-hover table-striped table-bordered">
			<thead class='thead-inverse'>
			<tr>
				<th>问题</th>
				<th>提供选项</th>
				<th>选用</th>
			</tr>
			</thead>
			<form method='POST' id='ques_conf' enctype='multipart/form-data'>
			{% csrf_token %}
			<tbody>
				{% for attr in attrs %}
				<tr>
					<td>{{ attr.attr }}</td>
					{% if attr.is_option %}
					<td class='table-info' href="#collapse{{ attr.id }}" data-toggle="collapse">{{ attr.is_option }}</td>
					{% else %}
					<td>{{ attr.is_option }}</td>
					{% endif %}
					<td>
						<label class="c-input c-checkbox">
							<input type="checkbox" name='is_check' value='{{ attr.id }}'>
							<span class="c-indicator"></span>
						</label>
					</td>
				</tr>
				{% endfor %}
				<tr class='table-info'>
					<td>111</td>
					<td>222</td>
					<td>222</td>
				</tr>
				<tr>
					<td>333</td>
					<td>444</td>
					<td>444</td>
				</tr>
			</tbody>
			</form>
		</table>
		<input type='submit' form='ques_conf' value='问卷预览' onclick='ques_conf()'>
	</div>
	<div class="col-md-3">
	{% for attr in attrs %}
		<div class="collapse" id="collapse{{ attr.id }}">
			<ul class='list-group'>
			{% for option in attr.options.all %}
				<li class="list-group-item list-group-item-success">{{ option }}</li>
			{% endfor %}
			</ul>
		</div>
	{% endfor %}
	</div>
</div>
<script>
function ques_conf(){
	var box = document.getElementById('box_preview');
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.open('GET', '{% url "crm:ajax:preview" %}', true);
	xmlhttp.onreadystatechange=function()
	{
		if(xmlhttp.readyState==4 && xmlhttp.status==200)
		{
			var tag_new = xmlhttp.responseText;
			console.log(tag_new);
			box.innerHTML = tag_new;
		}
	}

	//var csrftoken = getCookie('csrftoken');
	//xmlhttp.setRequestHeader('X-CSRFToken',csrftoken);
	//xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
	xmlhttp.send();
}
</script>
{% endblock %}