{% extends 'base2.html' %}
{% block title %}问卷配置{% endblock %}
{% block header %}
<li><a href='{% url "crm:add" %}'>添加提问</a></li>
{% endblock %} 
{% block row-left %}
<div class="btn-group btn-group-vertical">
	<div class='btn'><h3>生成问卷</h3></div>
	<div class='btn'><h3>提问修改</h3></div>
	<div class='btn'><h3>添加提问</h3></div>
</div>
{% endblock %}
{% block row-right %}
<div class="row-fluid">
	<div class="span9" id='box_preview'>
		<table class="table table-hover table-striped">
			<thead>
			<tr>
				<th>问题</th>
				<th>提供选项</th>
				<th>选用</th>
			</tr>
			</thead>
			<form method='POST' id='ques_conf' enctype='multipart/form-data'>
				{% csrf_token %}
				<tbody>
				{% for attr in attrs %}
					{% if attr.is_option %}
					<tr class='success panel-title' href="#collapse{{ attr.id }}" data-toggle="collapse" aria-controls="collapse{{ attr.id }}">
					{% else %}
					<tr>
				{% endif %}
						<td class='span6'>{{ attr.attr }}</td>
						<td class='span4'>{{ attr.is_option }}</td>
						<td class='span2'>
							<label class="c-input c-checkbox">
								<input type="checkbox" name='is_check' value='{{ attr.id }}'>
								<span class="c-indicator"></span>
							</label>
						</td>
					</tr>
				{% endfor %}
					<tr class='error'>
						<td>111</td>
						<td>222</td>
						<td>222</td>
					</tr>
					<tr>
						<td>333</td>
						<td>444</td>
						<td>444</td>
					</tr>
				</tbody>
			</form>
		</table>
		<input type='submit' form='ques_conf' value='问卷预览' onclick='ques_conf()'>
	</div>
	<div class="span3">
	{% for attr in attrs %}
		<div class="collapse in" id="collapse{{ attr.id }}">
			{{ attr.options }}
		</div>
	{% endfor %}
	</div>
</div>
<script>
function ques_conf(){
	var box = document.getElementById('box_preview');
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.open('GET', '{% url "crm:ajax:preview" %}', true);
	xmlhttp.onreadystatechange=function()
	{
		if(xmlhttp.readyState==4 && xmlhttp.status==200)
		{
			var tag_new = xmlhttp.responseText;
			console.log(tag_new);
			box.innerHTML = tag_new;
		}
	}

	//var csrftoken = getCookie('csrftoken');
	//xmlhttp.setRequestHeader('X-CSRFToken',csrftoken);
	//xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
	xmlhttp.send();
}
</script>
{% endblock %}